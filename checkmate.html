<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkmate Challenge</title>
<style>
body { font-family: sans-serif; margin:0; background:#f5f5f5; color:#222; text-align:center; }
h1 { margin:20px 0; color:#dbac16; }
.container { max-width: 800px; margin: auto; padding: 20px; }
.game-card { background:#fff; border-radius:8px; padding:15px; margin:15px 0; box-shadow:0 3px 6px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
.game-info { text-align:left; }
.play-btn { padding:8px 16px; background:#dbac16; border:none; border-radius:5px; cursor:pointer; font-weight:bold; color:#000; }
.status-dot { width:12px; height:12px; border-radius:50%; display:inline-block; margin-right:5px; background:green; }
</style>
</head>
<body>

<h1>Checkmate Challenge</h1>
<div class="container" id="games-container">
  <p>Chargement des parties...</p>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// âš¡ Firebase Configuration
const firebaseConfig = {
  apiKey: "TON_API_KEY",
  authDomain: "c-b-r-4e772-default-rtdb.firebaseapp.com",
  databaseURL: "https://c-b-r-4e772-default-rtdb.firebaseio.com",
  projectId: "c-b-r-4e772",
  storageBucket: "c-b-r-4e772.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸ”¹ GÃ©nÃ©rer un ID utilisateur alÃ©atoire
const userId = 'user_' + Math.floor(Math.random()*10000);

// ðŸ”¹ CrÃ©er une partie alÃ©atoire si aucune partie existe
function createRandomGame() {
  const newGameRef = db.ref('checkmateChallenge/games').push();
  newGameRef.set({
    players: { white: userId, black: 'user_' + Math.floor(Math.random()*10000) },
    puzzle: { fen: "r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 2 3", solution: ["e2e4","d7d5","f1c4"] },
    status: "playing",
    spectators: []
  });
}

// ðŸ”¹ Afficher toutes les parties
function renderGames(games) {
  const container = document.getElementById('games-container');
  container.innerHTML = '';
  if(!games) {
    container.innerHTML = '<p>Aucune partie disponible pour le moment.</p>';
    return;
  }
  Object.keys(games).forEach(gameId => {
    const game = games[gameId];
    const div = document.createElement('div');
    div.className = 'game-card';
    div.innerHTML = `
      <div class="game-info">
        <strong>${game.players.white} vs ${game.players.black}</strong><br>
        <span class="status-dot"></span>${Object.keys(game.spectators||{}).length} spectateurs
      </div>
      <button class="play-btn" onclick="joinGame('${gameId}')">Jouer</button>
    `;
    container.appendChild(div);
  });
}

// ðŸ”¹ Rejoindre une partie
function joinGame(gameId) {
  const gameRef = db.ref('checkmateChallenge/games/' + gameId + '/spectators');
  gameRef.child(userId).set(true);
  alert("Vous avez rejoint la partie : " + gameId);
}

// ðŸ”¹ Ã‰couteur Realtime Database
db.ref('checkmateChallenge/games').on('value', snapshot => {
  renderGames(snapshot.val());
});

// âš¡ CrÃ©er une partie alÃ©atoire si aucune partie existante
db.ref('checkmateChallenge/games').once('value').then(snapshot => {
  if(!snapshot.exists()) createRandomGame();
});
</script>

</body>
</html>
