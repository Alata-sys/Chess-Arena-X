<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Battle Run</title>
    <style>
        :root { --bg: #161512; --accent: #dbac16; --success: #629924; }
        body { background: var(--bg); color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .container { background: #262421; border-radius: 10px; padding: 20px; max-width: 450px; margin: 0 auto; border-top: 5px solid var(--accent); }
        .status { margin: 15px 0; font-weight: bold; }
        .user-card { background: #302e2c; padding: 15px; border-radius: 5px; display: none; margin-top: 20px; }
        button { background: var(--accent); color: black; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .error { color: #ff4444; background: rgba(255,0,0,0.1); padding: 10px; border-radius: 5px; display: none; }

        /* Animation des piÃ¨ces d'Ã©checs */
        .chess-loader {
            display: inline-block;
            font-size: 2em;
            animation: bounce 0.8s infinite alternate;
            margin-right: 10px;
        }

        @keyframes bounce {
            0% { transform: translateY(0); color: white; }
            100% { transform: translateY(-10px); color: var(--accent); }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>CHESS BATTLE RUN</h1>
        
        <div id="status-box" class="status">
            <span class="chess-loader">â™ž</span> <!-- Symbole Cavalier pour l'animation -->
            <span id="status-text">Initialisation...</span>
        </div>
        <div id="error-box" class="error"></div>

        <div id="user-info" class="user-card">
            <p>Bienvenue, <span id="username" style="color:var(--accent); font-size: 1.2em;"></span> !</p>
            <p style="font-size: 0.9em; opacity: 0.8;">Connexion active avec Lichess API</p>
            <button onclick="resetConnection()" style="background:#8b0000;">DÃ©connexion</button>
        </div>
    </div>

    <script>
        const statusEl = document.getElementById('status-text');
        const userEl = document.getElementById('user-info');
        const errorEl = document.getElementById('error-box');
        const loaderEl = document.querySelector('.chess-loader');

        let TOKEN = localStorage.getItem('CHESS_BATTLE_TOKEN');

        async function startEngine() {
            if (!TOKEN) {
                loaderEl.style.display = 'none';
                TOKEN = prompt("ðŸ”‘ CONFIGURATION CHESS BATTLE RUN\nColle ton Token Lichess ici (il sera sauvÃ© localement) :");
                if (TOKEN && TOKEN.trim() !== "") {
                    localStorage.setItem('CHESS_BATTLE_TOKEN', TOKEN.trim());
                    location.reload();
                } else {
                    statusEl.innerHTML = "En attente du jeton API...";
                    return;
                }
            }

            try {
                // CODE DE FETCH CORRIGÃ‰ ET OPÃ‰RATIONNEL :
                const response = await fetch('https://lichess.org/api/account', {
    method: 'GET',
    headers: {
        'Authorization': 'Bearer ' + TOKEN,
        'Accept': 'application/json'
    }
});

                if (response.status === 401) throw new Error("Token invalide ou banni.");
                if (!response.ok) throw new Error("Erreur rÃ©seau Lichess.");

                const data = await response.json();
                
                // SuccÃ¨s
                loaderEl.style.display = 'none';
                statusEl.innerHTML = "SystÃ¨me PrÃªt";
                document.getElementById('username').innerText = data.username;
                userEl.style.display = 'block';

            } catch (error) {
                loaderEl.style.display = 'none';
                statusEl.innerHTML = "Erreur systÃ¨me";
                errorEl.innerText = error.message;
                errorEl.style.display = 'block';
                
                if (error.message.includes("401") || error.message.includes("invalide")) {
                    localStorage.removeItem('CHESS_BATTLE_TOKEN');
                }
            }
        }

        function resetConnection() {
            if(confirm("Voulez-vous supprimer le Token de ce navigateur ?")) {
                localStorage.removeItem('CHESS_BATTLE_TOKEN');
                location.reload();
            }
        }

        window.onload = startEngine;
    </script>
</body>
</html>

