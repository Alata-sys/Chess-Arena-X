<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Battle Run</title>
    <style>
        :root { --bg: #161512; --accent: #dbac16; --success: #629924; }
        body { background: var(--bg); color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .container { background: #262421; border-radius: 10px; padding: 20px; max-width: 450px; margin: 0 auto; border-top: 5px solid var(--accent); shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .status { margin: 15px 0; font-weight: bold; }
        .user-card { background: #302e2c; padding: 15px; border-radius: 5px; display: none; margin-top: 20px; }
        button { background: #45a049; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .error { color: #ff4444; background: rgba(255,0,0,0.1); padding: 10px; border-radius: 5px; display: none; }

        /* Style pour l'animation de chargement */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>CHESS BATTLE RUN</h1>
        
        <div id="status-box" class="status">
            <span class="loader"></span>
            <span id="status-text">Initialisation...</span>
        </div>
        <div id="error-box" class="error"></div>

        <div id="user-info" class="user-card">
            <p>Bienvenue, <span id="username" style="color:var(--accent); font-size: 1.2em;"></span> !</p>
            <p style="font-size: 0.9em; opacity: 0.8;">Connexion active avec Lichess API</p>
            <button onclick="resetConnection()" style="background:#8b0000;">D√©connexion</button>
        </div>
    </div>

    <script>
        const statusEl = document.getElementById('status-text');
        const userEl = document.getElementById('user-info');
        const nameEl = document.getElementById('username');
        const errorEl = document.getElementById('error-box');
        const loaderEl = document.querySelector('.loader');

        let TOKEN = localStorage.getItem('CHESS_BATTLE_TOKEN');

        async function startEngine() {
            if (!TOKEN) {
                loaderEl.style.display = 'none';
                TOKEN = prompt("üîë CONFIGURATION CHESS BATTLE RUN\nColle ton Token Lichess ici (il sera sauv√© localement) :");
                if (TOKEN && TOKEN.trim() !== "") {
                    localStorage.setItem('CHESS_BATTLE_TOKEN', TOKEN.trim());
                    location.reload();
                } else {
                    statusEl.innerHTML = "En attente du jeton API...";
                    return;
                }
            }

            try {
                // LIGNE CORRIG√âE : Utilisation de l'endpoint /api/account
                const response = await fetch('https://lichess.org', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + TOKEN,
                        'Accept': 'application/json'
                    }
                });

                if (response.status === 401) {
                    throw new Error("Ton Token est invalide ou a √©t√© banni.");
                }

                if (!response.ok) throw new Error("Erreur de connexion r√©seau √† Lichess");

                const data = await response.json();
                
                // Succ√®s
                loaderEl.style.display = 'none';
                statusEl.innerHTML = "<span style='color:#629924;'>Syst√®me Pr√™t</span>";
                nameEl.innerText = data.username;
                userEl.style.display = 'block';
                
                console.log("Connect√© en tant que :", data.username);
                // --- ICI : Int√®gre le reste de ton moteur Arena X ---

            } catch (error) {
                loaderEl.style.display = 'none';
                statusEl.innerHTML = "<span style='color:#ff4444;'>Erreur syst√®me</span>";
                errorEl.innerText = error.message;
                errorEl.style.display = 'block';
                
                if (error.message.includes("401") || error.message.includes("invalide")) {
                    localStorage.removeItem('CHESS_BATTLE_TOKEN');
                }
            }
        }

        function resetConnection() {
            if(confirm("Voulez-vous supprimer le Token de ce navigateur ?")) {
                localStorage.removeItem('CHESS_BATTLE_TOKEN');
                location.reload();
            }
        }

        window.onload = startEngine;
    </script>
</body>
</html>
